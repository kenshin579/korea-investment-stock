name: Publish to PyPI

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  publish:
    uses: kenshin579/actions/.github/workflows/pypi-publish.yml@main
    with:
      python_version: '3.12'
      run_tests: true
      test_command: |
        pytest korea_investment_stock/ -v \
          --ignore=korea_investment_stock/test_korea_investment_stock.py \
          --ignore=korea_investment_stock/test_integration_us_stocks.py \
          --ignore=korea_investment_stock/cache/test_cached_integration.py \
          -k "not (Redis or redis_storage or TestTokenStorageIntegration)"
    secrets:
      PYPI_API_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
