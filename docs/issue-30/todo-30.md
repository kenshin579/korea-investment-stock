# 공모주청약일정 API 구현 TODO List

## 📋 개요
- **목표**: 한국투자증권 공모주청약일정 API를 korea-investment-stock 라이브러리에 통합
- **예상 기간**: 7일
- **담당자**: TBD

## ✅ Phase 1: API 구현 및 기본 기능 (2일)

### 1.1 API 메서드 구현
- [x] `fetch_ipo_schedule()` 메서드 구현
  - [x] 기본 파라미터 처리 (from_date, to_date, symbol)
  - [x] 날짜 기본값 설정 로직 (오늘 ~ 30일 후)
  - [x] 모의투자 체크 및 에러 처리
  - [x] API 호출 및 응답 처리

### 1.2 Rate Limiting 통합
- [x] `@retry_on_rate_limit()` 데코레이터 적용
- [x] `self.rate_limiter.acquire()` 호출 추가
- [x] Rate limit 에러 시 자동 재시도 확인

### 1.3 캐싱 통합
- [x] `@cacheable()` 데코레이터 적용
- [x] 캐시 키 생성 로직 구현
  - [x] `fetch_ipo_schedule:{from_date}:{to_date}:{symbol or 'ALL'}`
- [x] TTL 3600초 설정 확인

## ✅ Phase 2: 헬퍼 함수 및 데이터 처리 (1일)

### 2.1 날짜 관련 헬퍼 함수
- [x] `validate_date_format()` - YYYYMMDD 형식 검증
- [x] `validate_date_range()` - 시작일/종료일 유효성 검증
- [x] `parse_ipo_date_range()` - "2024.01.15~2024.01.16" 형식 파싱
- [x] `format_ipo_date()` - 날짜 형식 변환
- [x] `calculate_ipo_d_day()` - D-Day 계산

### 2.2 데이터 처리 헬퍼 함수
- [x] `get_ipo_status()` - 청약 상태 판단 (예정/진행중/마감)
- [x] `format_number()` - 숫자 천단위 콤마 추가

### 2.3 유틸리티 함수 위치 결정
- [x] `korea_investment_stock/utils/ipo_helpers.py` 파일 생성 여부 결정
- [x] 또는 메인 모듈에 포함할지 결정

## ✅ Phase 3: 에러 처리 및 검증 (1일)

### 3.1 입력 검증
- [x] 날짜 형식 검증 (YYYYMMDD)
- [x] 날짜 범위 검증 (시작일 <= 종료일)
- [x] 종목코드 형식 검증 (필요시)

### 3.2 에러 처리
- [x] `ValueError` - 모의투자 사용 시
- [x] `ValueError` - 날짜 형식 오류
- [x] `ValueError` - 날짜 범위 오류
- [x] API 응답 에러 처리

### 3.3 로깅
- [x] API 호출 로깅
- [x] 에러 발생 시 상세 로깅
- [x] 캐시 히트/미스 로깅

## ✅ Phase 4: 테스트 작성 (2일)

### 4.1 단위 테스트 (`test_ipo_schedule.py`)
- [x] 날짜 형식 검증 테스트
- [x] 날짜 범위 검증 테스트
- [x] 청약기간 파싱 테스트
- [x] 청약 상태 판단 테스트
- [x] D-Day 계산 테스트
- [x] 숫자 포맷팅 테스트

### 4.2 통합 테스트
- [x] 실제 API 호출 테스트 (실전투자)
- [x] 전체 조회 테스트
- [x] 기간별 조회 테스트
- [x] 특정 종목 조회 테스트
- [x] 모의투자 에러 테스트

### 4.3 성능 테스트
- [x] 캐시 동작 확인
- [x] Rate limiting 동작 확인
- [x] 응답 시간 측정

## ✅ Phase 5: 문서화 및 예제 (1일)

### 5.1 코드 문서화
- [x] 메서드 docstring 작성
- [x] 파라미터 설명
- [x] 반환값 형식 설명
- [x] 예제 코드 포함

### 5.2 README 업데이트
- [x] 공모주 조회 기능 섹션 추가
- [x] 설치 및 사용법 설명
- [x] 기본 사용 예제
- [x] 고급 활용 예제

### 5.3 예제 스크립트
- [x] `examples/ipo_schedule_example.py` 작성
  - [x] 전체 조회 예제
  - [x] 청약 진행중 필터링 예제
  - [x] D-Day 계산 예제
  - [x] 공모주 상세 정보 출력 예제

### 5.4 주의사항 문서화
- [x] 모의투자 미지원 명시
- [x] 예탁원 정보 기반 데이터임을 명시
- [x] 정보용으로만 사용 권고
- [x] 실제 청약 시 공식 공고문 확인 필요

## 📌 체크리스트

### 구현 전 확인사항
- [x] 실제 API 엔드포인트 접근 가능 여부
- [x] API 키/시크릿 준비
- [x] 실전투자 계좌 준비

### 구현 중 확인사항
- [x] 기존 Rate Limiter와 정상 통합
- [x] 기존 캐싱 시스템과 정상 통합
- [x] 기존 에러 처리 패턴 준수

### 구현 후 확인사항
- [x] 모든 테스트 통과
- [x] 문서화 완료
- [x] 예제 코드 동작 확인
- [x] PR 생성 및 리뷰 요청

## 🔧 기술적 고려사항

### API 관련
- [x] TR_ID: `HHKDB669108C0` 정확히 사용
- [x] custtype: "P" (개인) 헤더 추가
- [x] 응답 구조 확인 (output1 배열)

### 데이터 처리
- [x] 청약기간 문자열 파싱 ("YYYY.MM.DD~YYYY.MM.DD")
- [x] 모든 숫자 필드는 문자열로 반환됨
- [x] 빈 결과 처리

### 성능 최적화
- [x] 캐시 TTL 3600초 적절성 검토
- [x] 대량 조회 시 페이징 필요 여부 확인

## 📝 참고사항

### 우선순위
1. **필수**: API 메서드 구현, 기본 테스트
2. **중요**: 에러 처리, 캐싱 통합
3. **선택**: 고급 예제, 성능 최적화

### 예상 난이도
- **쉬움**: 헬퍼 함수, 문서화
- **보통**: API 구현, 테스트 작성
- **어려움**: 날짜 파싱 엣지 케이스 처리

### 관련 이슈
- Issue #30: 공모주청약일정 API 추가
- 기존 Rate Limiting 시스템 (#27)

## 📅 일정

| Phase | 작업 내용 | 예상 기간 | 상태 |
|-------|----------|----------|------|
| 1 | API 구현 및 기본 기능 | 2일 | 완료 |
| 2 | 헬퍼 함수 및 데이터 처리 | 1일 | 완료 |
| 3 | 에러 처리 및 검증 | 1일 | 완료 |
| 4 | 테스트 작성 | 2일 | 완료 |
| 5 | 문서화 및 예제 | 1일 | 완료 |

**총 예상 기간**: 7일

## 🎯 완료 기준
- [x] 모든 테스트 통과
- [x] 코드 리뷰 완료
- [x] 문서화 완료
- [x] main 브랜치 머지 